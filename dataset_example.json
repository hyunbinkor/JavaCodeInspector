{
  "issue_record_id": "CONN_LEAK_001",
  
  "metadata": {
    "title": "Database Connection 미해제로 인한 Connection Pool 고갈",
    "category": "resource_management",
    "severity": "HIGH",
    "tags": ["database", "connection", "leak", "resource", "pool"],
    "created_date": "2024-01-15T09:30:00Z",
    "last_updated": "2024-03-10T14:20:00Z"
  },

  "anti_pattern": {
    "code_template": "@Service\npublic class UserService {\n    \n    public User createUser(String name) {\n        Connection conn = dataSource.getConnection();\n        String sql = \"INSERT INTO users (name) VALUES (?)\";\n        PreparedStatement stmt = conn.prepareStatement(sql);\n        stmt.setString(1, name);\n        stmt.executeUpdate();\n        // conn.close() 누락!\n        \n        return findUserById(userId);\n    }\n}",
    
    "pattern_signature": {
      "ast_signature": "VariableDeclaration(Connection) -> MethodInvocation(getConnection) -> [MethodInvocation(prepareStatement), MethodInvocation(executeUpdate)] -> MissingMethodCall(close)",
      "semantic_signature": "resource_creation_without_cleanup",
      "regex_patterns": [
        "Connection\\s+\\w+\\s*=.*getConnection\\(\\)",
        "(?!.*\\.close\\(\\).*)",
        "(?!.*try\\s*\\(.*Connection.*\\))"
      ]
    },
    
    "problematic_characteristics": {
      "missing_operations": ["close()", "try-with-resources"],
      "incorrect_usage": ["manual_connection_handling", "missing_resource_cleanup"],
      "framework_violations": ["bypassing_connection_management", "not_using_transaction_boundary"]
    }
  },

  "recommended_pattern": {
    "code_template": "@Service\n@Transactional\npublic class UserService {\n    \n    public User createUser(String name) {\n        try (Connection conn = dataSource.getConnection()) {\n            String sql = \"INSERT INTO users (name) VALUES (?)\";\n            PreparedStatement stmt = conn.prepareStatement(sql);\n            stmt.setString(1, name);\n            stmt.executeUpdate();\n            \n            return findUserById(userId);\n        }\n    }\n}",
    
    "pattern_name": "try_with_resources_connection_management",
    
    "implementation_guide": {
      "best_practices": [
        "try-with-resources 구문을 사용하여 자동 리소스 해제",
        "@Transactional 어노테이션으로 트랜잭션 경계 명확화",
        "PreparedStatement도 try-with-resources에 포함",
        "connection pool 설정 확인 및 모니터링"
      ],
      "framework_specific_notes": [
        "사내 DataAccessLayer 상속 시 자동 connection 관리 제공",
        "@DatabaseTransaction 어노테이션 사용 시 connection 생명주기 자동 관리",
        "BaseService의 executeWithConnection() 메소드 활용 권장"
      ],
      "alternative_approaches": [
        {
          "approach_name": "framework_managed_connection",
          "code_example": "@Service\npublic class UserService extends DataAccessLayer {\n    public User createUser(String name) {\n        return executeWithConnection(conn -> {\n            // 작업 수행\n        });\n    }\n}",
          "use_case": "사내 프레임워크 사용 시 권장"
        },
        {
          "approach_name": "repository_pattern",
          "code_example": "@Repository\npublic class UserRepository {\n    @Autowired\n    private JdbcTemplate jdbcTemplate;\n    \n    public void createUser(String name) {\n        jdbcTemplate.update(\"INSERT INTO users (name) VALUES (?)\", name);\n    }\n}",
          "use_case": "Spring 프레임워크 사용 시"
        }
      ]
    }
  },

  "detection_rules": {
    "ast_rules": [
      {
        "rule_name": "connection_without_close",
        "rule_expression": "VariableDeclaration(Connection) AND MethodInvocation(getConnection) AND NOT (MethodInvocation(close) OR TryWithResourcesStatement)",
        "confidence_score": 0.95
      },
      {
        "rule_name": "manual_connection_handling",
        "rule_expression": "MethodInvocation(getConnection) AND NOT AnnotationPresent(@Transactional)",
        "confidence_score": 0.75
      }
    ],
    
    "semantic_rules": [
      {
        "rule_name": "resource_lifecycle_violation",
        "rule_description": "리소스 생성 후 적절한 해제 메커니즘 부재",
        "pattern_indicators": [
          "getConnection() 호출",
          "close() 메소드 부재",
          "try-with-resources 미사용",
          "finally 블록 내 cleanup 부재"
        ]
      }
    ],
    
    "heuristic_rules": [
      {
        "rule_name": "connection_usage_pattern",
        "logic": "Connection 변수 선언 후 3줄 이내에 SQL 실행 메소드 호출 시 리소스 누수 의심",
        "false_positive_filters": [
          "메소드가 private이고 caller에서 connection 관리하는 경우",
          "utility 메소드로 connection을 파라미터로 받는 경우"
        ]
      }
    ]
  },

  "impact_analysis": {
    "production_impact": {
      "failure_scenarios": [
        "connection_pool_exhaustion",
        "database_connection_timeout", 
        "service_unavailability",
        "cascading_failure_to_dependent_services"
      ],
      "performance_degradation": {
        "response_time_impact": "점진적 증가 (30분~2시간 내 서비스 불가)",
        "throughput_impact": "신규 요청 처리 불가",
        "resource_consumption": "DB connection pool 100% 사용률"
      },
      "security_implications": [
        "dos_vulnerability",
        "resource_exhaustion_attack"
      ]
    },
    
    "historical_data": {
      "occurrence_frequency": 23,
      "incident_references": [
        {
          "incident_id": "INC-2023-0892",
          "date": "2023-08-15",
          "impact_level": "SERVICE_DOWN",
          "resolution_time": "2.5 hours"
        },
        {
          "incident_id": "INC-2024-0156", 
          "date": "2024-02-03",
          "impact_level": "PERFORMANCE_DEGRADATION",
          "resolution_time": "45 minutes"
        }
      ],
      "fix_effort_estimation": {
        "complexity": "LOW",
        "estimated_hours": 2,
        "required_expertise": ["java_developer", "database_admin"]
      }
    }
  },

  "framework_context": {
    "framework_version": "CustomFramework-2.x",
    "applicable_components": {
      "custom_annotations": [
        "@DatabaseTransaction",
        "@ConnectionManaged", 
        "@ResourceMonitoring"
      ],
      "custom_classes": [
        "BaseService",
        "DataAccessLayer", 
        "ConnectionManager",
        "ManagedConnection"
      ],
      "framework_apis": [
        "DataAccessLayer.executeWithConnection()",
        "ConnectionManager.getConnection()",
        "TransactionManager.doInTransaction()"
      ]
    },
    "compatibility_notes": [
      "Framework 3.x에서는 자동 connection 관리 지원",
      "2.1 이상에서 @ConnectionManaged 어노테이션 사용 가능",
      "Legacy 1.x 버전에서는 manual cleanup 필수"
    ]
  },

  "embeddings": {
    "combined_embedding": [
      0.0123, 0.0456, 0.0789, 0.0234, 0.0567, 0.0890, 0.0345, 0.0678,
      0.0901, 0.0234, 0.0567, 0.0890, 0.0123, 0.0456, 0.0789, 0.0234,
      "... (총 480개 요소)"
    ],
    "component_embeddings": {
      "syntactic_embedding": [
        0.0234, 0.0567, 0.0890, 0.0123, "... (128개)"
      ],
      "semantic_embedding": [
        0.0456, 0.0789, 0.0234, 0.0567, "... (256개)"
      ],
      "framework_embedding": [
        0.0678, 0.0901, 0.0234, 0.0567, "... (64개)"
      ],
      "context_embedding": [
        0.0890, 0.0123, 0.0456, 0.0789, "... (32개)"
      ]
    },
    "embedding_metadata": {
      "embedding_version": "v1.0",
      "created_timestamp": "2024-03-10T14:20:00Z",
      "model_version": "CustomEmbedding-1.0.0"
    }
  },

  "validation_info": {
    "reviewed_by": "senior_architect_kim",
    "review_date": "2024-03-08",
    "validation_status": "APPROVED",
    "quality_score": 0.92
  },

  "related_patterns": [
    {
      "pattern_id": "STMT_LEAK_002",
      "relationship_type": "similar",
      "similarity_score": 0.85
    },
    {
      "pattern_id": "TX_BOUNDARY_015",
      "relationship_type": "complementary", 
      "similarity_score": 0.72
    },
    {
      "pattern_id": "POOL_CONFIG_008",
      "relationship_type": "prerequisite",
      "similarity_score": 0.68
    }
  ]
}